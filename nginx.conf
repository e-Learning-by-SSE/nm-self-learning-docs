server {
    listen 8080;
    server_name _;

    root  /usr/share/nginx/html;
    index index.html;

    # Prevent externally visible redirects that include :8080 etc.
    absolute_redirect off;
    port_in_redirect off;
    server_name_in_redirect off;
    
    # Detect mount prefix from reverse proxy
    map $http_x_forwarded_prefix $mount_prefix {
        default "";
        ~^(/.*)$ $1;   # e.g. "/docs"
    }

    # Redirect ONLY the root (preserve mount)
    location = / {
        if ($mount_prefix != "") { return 302 $mount_prefix/de/index.html; }
        return 302 /de/index.html;
    }

    # Serve static assets under _static/ directly (no SPA fallback)
    location ^~ /_static/ {
        try_files $uri =404;
        expires 7d;
        access_log off;
    }

    # Everything else:
    location / {
        # If a directory was hit without trailing slash, add it (keeps mount via $request_uri)
        if (-d $request_filename) {
            return 302 $request_uri/;
        }

        # Serve files or directory; if not found, SPA fallback to root index.html
        try_files $uri $uri/ /index.html;
    }
	
	# Do not show folder content if no site is selected
	autoindex off;
}
