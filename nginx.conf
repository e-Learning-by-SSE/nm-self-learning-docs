server {
    listen 8080;
    server_name _;

    root  /usr/share/nginx/html;
    index index.html;

    # Prevent externally visible redirects that include :8080 etc.
    absolute_redirect off;
    port_in_redirect off;
    server_name_in_redirect off;
    
    # 1) Root of the app â†’ relative redirect keeps reverse-proxy subfolder
    location = / {
        return 302 de/index.html;
    }

    # 2) Static assets: serve as files (prevents SPA fallback swallowing CSS/JS)
    location ^~ /_static/ {
        try_files $uri =404;
        expires 7d;
        access_log off;
    }

    # 3) Everything else
    location / {
        # Redirect paths that look like "folders" but lack a trailing slash
        # Use a RELATIVE redirect so the mount is kept.
        # Matches URIs without a dot and without trailing slash, e.g. /en, /foo/bar
        rewrite ^([^.]*[^/])$ $request_uri/ redirect;

        # Serve file or directory index internally; fallback to SPA index.html
        try_files $uri $uri/ /index.html;
    }
	
	# Do not show folder content if no site is selected
	autoindex off;
}
