server {
    listen 8080;
    server_name _;

    root  /usr/share/nginx/html;
    index index.html;

    # Prevent externally visible redirects that include :8080 etc.
    absolute_redirect off;
    port_in_redirect off;
    server_name_in_redirect off;
    
    # 1) Root of the app â†’ relative redirect keeps reverse-proxy subfolder
    location = / {
        return 302 de/index.html;   # NOTE: no leading slash
    }

    # 2) Static assets: serve as files (prevents SPA fallback swallowing CSS/JS)
    location ^~ /_static/ {
        try_files $uri =404;
        expires 7d;
        access_log off;
    }

    # 3) Everything else
    location / {
        # If a directory was requested WITHOUT a trailing slash (e.g., /en),
        # redirect to that directory's index.html using a RELATIVE Location.
        if (-d $request_filename) {
            # strip leading "/" from $uri to build a relative path
            set $rel $uri;
            if ($rel ~ "^/(.*)$") { set $rel $1; }
            return 302 $rel/index.html;   # e.g., "en/index.html"
        }

        # Serve file or dir; otherwise SPA fallback
        try_files $uri $uri/ /index.html;
    }
	
	# Do not show folder content if no site is selected
	autoindex off;
}
